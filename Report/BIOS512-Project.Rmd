---
title: 'Unsupervised Exploration of Wine Chemistry'
author: "Alexis Bryant"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    theme: cosmo
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
install.packages("tidyverse")
install.packages("factoextra")
install.packages("GGally")
install.packages("mclust")
library(tidyverse)
library(cluster)
library(factoextra)
library(GGally)
library(mclust)

set.seed(123)
theme_set(theme_minimal())
```

# Introduction

This project analyzes a Kaggle wine dataset containing laboratory measurements of wines grown in the same region of Italy.
Each of the **178 samples** has **13 chemical attributes** and no cultivar label; some copies of the file include an unlabeled numeric `target` code (0, 1, 2), but it is *not required* for the analysis.
Because cultivar identities are unknown (and the `target` column may be missing), the analysis emphasizes unsupervised structure rather than supervised prediction.
The analysis addresses three questions:

1.  *Which chemical measurements drive the largest variability in the wines?*
2.  *Do natural clusters emerge from chemistry alone, and how stable are they?*
3.  *If anonymous `target` codes are present, how do the unsupervised clusters compare?*

To answer them, the report combines exploratory data analysis (EDA), **principal component analysis (PCA)** for dimensionality reduction, **k-means clustering**, **hierarchical clustering**, and internal cluster validation (silhouette width and the gap statistic).

# Data Loading and Codebook

```{r}
wine_raw <- read_csv("wine_dataset.csv", show_col_types = FALSE)

has_target <- "target" %in% names(wine_raw)

wine <- wine_raw %>%
  rename(
    Alcohol = alcohol,
    Malic_Acid = malic_acid,
    Ash = ash,
    Alkalinity_of_Ash = alcalinity_of_ash,
    Magnesium = magnesium,
    Total_Phenols = total_phenols,
    Flavanoids = flavanoids,
    Nonflavanoid_Phenols = nonflavanoid_phenols,
    Proanthocyanins = proanthocyanins,
    Color_Intensity = color_intensity,
    Hue = hue,
    OD280_OD315 = `od280/od315_of_diluted_wines`,
    Proline = proline
  ) %>%
  {
    if (has_target) rename(., Target = target) else .
  }

feature_cols <- setdiff(names(wine), "Target")


glimpse(wine)
summary(select(wine, all_of(feature_cols)))
```

**Codebook**

```{r}
base_codebook <- tribble(
  ~Variable, ~Description,
  "Alcohol", "Alcohol content (% by volume)",
  "Malic_Acid", "Malic acid concentration (g/L)",
  "Ash", "Ash content (g/100 mL)",
  "Alkalinity_of_Ash", "Alkalinity of ash (mEq/L)",
  "Magnesium", "Magnesium content (mg/L)",
  "Total_Phenols", "Total phenolic compounds (g/L)",
  "Flavanoids", "Flavonoid content (g/L)",
  "Nonflavanoid_Phenols", "Non-flavonoid phenols (g/L)",
  "Proanthocyanins", "Proanthocyanins (g/L)",
  "Color_Intensity", "Color intensity (absorbance units)",
  "Hue", "Hue of the wine color (ratio)",
  "OD280_OD315", "Optical density ratio at 280/315 nm",
  "Proline", "Proline concentration (mg/L)"
)

codebook <- if (has_target) {
  bind_rows(base_codebook, tibble(Variable = "Target", Description = "Anonymous numeric grouping code (0, 1, 2)"))
} else {
  base_codebook
}

knitr::kable(codebook, caption = "Wine attribute codebook")
```

# Exploratory Data Analysis

```{r fig.width=10, fig.height=8}
wine_long <- wine %>%
  pivot_longer(cols = all_of(feature_cols), names_to = "Variable", values_to = "Value")

ggplot(wine_long, aes(x = Value)) +
  geom_histogram(bins = 25, fill = "#8C2D2D", color = "white") +
  facet_wrap(~Variable, scales = "free") +
  labs(title = "Distribution of Wine Chemistry Features", x = "Value", y = "Count")
```

Many features are right-skewed (e.g., **Proline**) while others are roughly symmetric.
This motivates standardizing variables before PCA and clustering.

```{r fig.width=7, fig.height=6}
GGally::ggcorr(wine %>% select(all_of(feature_cols)), label = TRUE, label_round = 2, hjust = 0.75) +
  labs(title = "Correlation Matrix of Chemical Attributes")
```

Strong positive correlations among **Total_Phenols**, **Flavanoids**, and **OD280_OD315** suggest overlapping information that PCA can consolidate.
The weak correlation between **Alcohol** and **Hue** hints that color properties may move independently of alcohol levels.

# Dimensionality Reduction with PCA

```{r fig.width=7, fig.height=5}
wine_scaled <- scale(select(wine, all_of(feature_cols)))
pca <- prcomp(wine_scaled, center = TRUE, scale. = TRUE)


fviz_eig(pca) + labs(title = "Variance Explained by Principal Components")
```

```{r fig.width=7, fig.height=6}
fviz_pca_biplot(pca,
  col.ind = "red",
  col.var = "blue",
  repel = TRUE,
  labelsize = 3
) +
  labs(title = "PCA Biplot (unsupervised)")
```

The first two components capture most variability and visually separate the wines along phenolic intensity.
**Flavanoids**, **Total_Phenols**, and **OD280_OD315** load heavily on PC1, highlighting their shared influence.
PC2 tilts toward **Malic_Acid** and **Alkalinity_of_Ash**, indicating an acidity-driven axis that subtly distinguishes samples.

# Clustering

```{r fig.width=7, fig.height=5}
km <- kmeans(wine_scaled, centers = 3, nstart = 25)

fviz_cluster(km,
  data = wine_scaled,
  geom = "point",
  ellipse.type = "norm",
  ggtheme = theme_minimal(),
  main = "K-Means Clustering of Wines (k = 3)"
)
```

```{r}
sil_width <- silhouette(km$cluster, dist(wine_scaled))
mean_sil <- mean(sil_width[, 3])
mean_sil
```

The clusters separate cleanly in PCA space, and the average silhouette width of **`r round(mean_sil, 2)`** indicates reasonably well-separated groups even without cultivar labels.

```{r fig.width=7, fig.height=5}
fviz_nbclust(wine_scaled, kmeans, method = "gap_stat", nstart = 25, nboot = 50) +
  labs(title = "Gap Statistic Suggests k = 3 Clusters")
```

```{r fig.width=7, fig.height=5}
hc <- hclust(dist(wine_scaled), method = "ward.D2")
plot(hc, labels = FALSE, hang = -1, main = "Hierarchical Clustering Dendrogram")
rect.hclust(hc, k = 3, border = "#8C2D2D")
```

```{r}
hc_clusters <- cutree(hc, k = 3)
km_vs_hc <- table(kmeans = km$cluster, hclust = hc_clusters)
km_vs_hc
```

The gap statistic peaks at **k = 3**, the dendrogram shows a clean three-branch split, and the cross-tabulation indicates strong agreement between k-means and hierarchical solutionsâ€”each method assigns most wines to the same clusters.

```{r}
if ("Target" %in% names(wine)) {
  ari <- mclust::adjustedRandIndex(as.numeric(wine$Target) + 1, km$cluster)
  ari
} else {
  "No target column present; ARI not computed."
}
```

When present, the anonymous `Target` codes serve as a silent referee: an ARI near 1 would signal near-perfect alignment, while lower values would highlight disagreement.
If the column is absent, the unsupervised diagnostics above stand on their own and remain the basis for interpreting structure.

# Conclusions and Next Steps

-   **Dimensionality reduction:** The first two PCs capture most variability and reveal separation driven by phenolic measurements.
-   **Unsupervised clustering:** K-means and hierarchical clustering agree on a three-cluster solution with solid silhouette support.
-   **Hidden-label check (optional):** When the dataset includes the anonymous `Target` codes, the adjusted Rand index shows strong alignment between unsupervised clusters and the hidden grouping; if the codes are absent, the unsupervised diagnostics stand on their own.

**Future work** could layer on density-based clustering (DBSCAN) to capture non-spherical groups, add bootstrapped stability analysis, or enrich the dataset with sensory scores to relate chemistry to perceived quality.
